{"version":3,"file":"index.ee972a78.js","sources":["../../src/layout/components/Search/index.vue"],"sourcesContent":["<script setup name=\"Search\">\nimport { deepClone, isExternalLink } from '@/util'\n\nconst { proxy } = getCurrentInstance()\n\nimport useSettingsStore from '@/store/modules/settings'\nconst settingsStore = useSettingsStore()\nimport useRouteStore from '@/store/modules/route'\nconst routeStore = useRouteStore()\nimport useMenuStore from '@/store/modules/menu'\nconst menuStore = useMenuStore()\n\nconst isShow = ref(false)\nconst searchInput = ref('')\nconst sourceList = ref([])\nconst actived = ref(-1)\n\nconst resultList = computed(() => {\n    let result = []\n    result = sourceList.value.filter(item => {\n        let flag = false\n        if (item.title.indexOf(searchInput.value) >= 0) {\n            flag = true\n        }\n        if (item.path.indexOf(searchInput.value) >= 0) {\n            flag = true\n        }\n        if (item.breadcrumb.some(b => b.indexOf(searchInput.value) >= 0)) {\n            flag = true\n        }\n        return flag\n    })\n    return result\n})\n\nwatch(() => isShow.value, val => {\n    if (val) {\n        document.querySelector('body').classList.add('hidden')\n        proxy.$refs.search.scrollTop = 0\n        // 当搜索显示的时候绑定上、下、回车快捷键，隐藏的时候再解绑。另外当 input 处于 focus 状态时，采用 vue 来绑定键盘事件\n        proxy.$hotkeys('up', keyUp)\n        proxy.$hotkeys('down', keyDown)\n        proxy.$hotkeys('enter', keyEnter)\n        setTimeout(() => {\n            proxy.$refs.input.focus()\n        }, 500)\n    } else {\n        document.querySelector('body').classList.remove('hidden')\n        proxy.$hotkeys.unbind('up', keyUp)\n        proxy.$hotkeys.unbind('down', keyDown)\n        proxy.$hotkeys.unbind('enter', keyEnter)\n        setTimeout(() => {\n            searchInput.value = ''\n            actived.value = -1\n        }, 500)\n    }\n})\nwatch(() => resultList.value, () => {\n    actived.value = -1\n    handleScroll()\n})\n\nonMounted(() => {\n    proxy.$eventBus.on('global-search-toggle', () => {\n        isShow.value = !isShow.value\n    })\n    proxy.$hotkeys('alt+s', e => {\n        if (settingsStore.topbar.enableNavSearch) {\n            e.preventDefault()\n            isShow.value = true\n        }\n    })\n    proxy.$hotkeys('esc', e => {\n        if (settingsStore.topbar.enableNavSearch) {\n            e.preventDefault()\n            isShow.value = false\n        }\n    })\n    if (settingsStore.app.routeBaseOn !== 'filesystem') {\n        routeStore.routes.map(item => {\n            getSourceList(item.children)\n        })\n    } else {\n        menuStore.menus.map(item => {\n            getSourceList(item.children)\n        })\n    }\n})\n\nfunction hasChildren(item) {\n    let flag = true\n    if (item.children) {\n        if (item.children.every(i => i.meta.sidebar === false)) {\n            flag = false\n        }\n    } else {\n        flag = false\n    }\n    return flag\n}\nfunction getSourceList(arr) {\n    arr.map(item => {\n        if (item.meta.sidebar !== false) {\n            if (hasChildren(item)) {\n                let baseBreadcrumb = item.meta.baseBreadcrumb ? deepClone(item.meta.baseBreadcrumb) : []\n                baseBreadcrumb.push(item.meta.title)\n                let child = deepClone(item.children)\n                child.map(c => {\n                    c.meta.baseIcon = item.meta.icon || item.meta.baseIcon\n                    c.meta.baseBreadcrumb = baseBreadcrumb\n                    c.meta.basePath = item.meta.basePath ? [item.meta.basePath, item.path].join('/') : item.path\n                })\n                getSourceList(child)\n            } else {\n                let breadcrumb = []\n                if (item.meta.baseBreadcrumb) {\n                    breadcrumb = deepClone(item.meta.baseBreadcrumb)\n                }\n                breadcrumb.push(item.meta.title)\n                let path = ''\n                if (isExternalLink(item.path)) {\n                    path = item.path\n                } else {\n                    path = item.meta.basePath ? [item.meta.basePath, item.path].join('/') : item.path\n                }\n                sourceList.value.push({\n                    icon: item.meta.icon || item.meta.baseIcon,\n                    title: item.meta.title,\n                    i18n: item.meta.i18n,\n                    breadcrumb: breadcrumb,\n                    path: path\n                })\n            }\n        }\n    })\n}\nfunction keyUp() {\n    if (resultList.value.length) {\n        actived.value -= 1\n        if (actived.value < 0) {\n            actived.value = resultList.value.length - 1\n        }\n        handleScroll()\n    }\n}\nfunction keyDown() {\n    if (resultList.value.length) {\n        actived.value += 1\n        if (actived.value > resultList.value.length - 1) {\n            actived.value = 0\n        }\n        handleScroll()\n    }\n}\nfunction keyEnter() {\n    if (actived.value !== -1) {\n        proxy.$refs[`search-item-${actived.value}`][0].click()\n    }\n}\nfunction handleScroll() {\n    let scrollTo = 0\n    if (actived.value !== -1) {\n        scrollTo = proxy.$refs['search'].scrollTop\n        const activedOffsetTop = proxy.$refs[`search-item-${actived.value}`][0].offsetTop\n        const activedClientHeight = proxy.$refs[`search-item-${actived.value}`][0].clientHeight\n        const searchScrollTop = proxy.$refs['search'].scrollTop\n        const searchClientHeight = proxy.$refs['search'].clientHeight\n        if (activedOffsetTop + activedClientHeight > searchScrollTop + searchClientHeight) {\n            scrollTo = activedOffsetTop + activedClientHeight - searchClientHeight\n        } else if (activedOffsetTop <= searchScrollTop) {\n            scrollTo = activedOffsetTop\n        }\n    }\n    proxy.$refs['search'].scrollTo({\n        top: scrollTo\n    })\n}\n</script>\n\n<template>\n    <div id=\"search\" :class=\"{'searching': isShow}\" @click=\"isShow && $eventBus.emit('global-search-toggle')\">\n        <div class=\"container\">\n            <div class=\"search-box\" @click.stop>\n                <el-input ref=\"input\" v-model=\"searchInput\" placeholder=\"搜索页面，支持标题、URL模糊查询\" clearable @keydown.esc=\"$eventBus.emit('global-search-toggle')\" @keydown.up.prevent=\"keyUp\" @keydown.down.prevent=\"keyDown\" @keydown.enter.prevent=\"keyEnter\">\n                    <template #prefix>\n                        <el-icon>\n                            <svg-icon name=\"ep:search\" />\n                        </el-icon>\n                    </template>\n                </el-input>\n                <div v-if=\"settingsStore.mode === 'pc'\" class=\"tips\">\n                    <div class=\"tip\">\n                        <span>Alt</span>+<span>S</span>\n                        唤醒搜索面板\n                    </div>\n                    <div class=\"tip\">\n                        <span>\n                            <el-icon>\n                                <svg-icon name=\"search-up\" />\n                            </el-icon>\n                        </span>\n                        <span>\n                            <el-icon>\n                                <svg-icon name=\"search-down\" />\n                            </el-icon>\n                        </span>\n                        切换搜索结果\n                    </div>\n                    <div class=\"tip\">\n                        <span>\n                            <el-icon>\n                                <svg-icon name=\"search-enter\" />\n                            </el-icon>\n                        </span>\n                        访问页面\n                    </div>\n                    <div class=\"tip\">\n                        <span>ESC</span>\n                        退出\n                    </div>\n                </div>\n            </div>\n            <div ref=\"search\" class=\"result\" :class=\"{'mobile': settingsStore.mode === 'mobile'}\">\n                <router-link v-for=\"(item, index) in resultList\" :key=\"item.path\" v-slot=\"{ href, navigate }\" custom :to=\"isShow ? item.path : ''\">\n                    <a :ref=\"`search-item-${index}`\" :href=\"isExternalLink(item.path) ? item.path : href\" class=\"item\" :class=\"{'actived': index === actived}\" :target=\"isExternalLink(item.path) ? '_blank' : '_self'\" @click=\"navigate\" @mouseover=\"actived = index\">\n                        <el-icon class=\"icon\">\n                            <svg-icon v-if=\"item.icon\" :name=\"item.icon\" />\n                        </el-icon>\n                        <div class=\"info\">\n                            <div class=\"title\">\n                                {{ item.title }}\n                            </div>\n                            <div class=\"breadcrumb\">\n                                <span v-for=\"(bc, bcIndex) in item.breadcrumb\" :key=\"bcIndex\">\n                                    {{ bc }}\n                                    <el-icon>\n                                        <svg-icon name=\"ep:arrow-right\" />\n                                    </el-icon>\n                                </span>\n                            </div>\n                            <div class=\"path\">{{ item.path }}</div>\n                        </div>\n                    </a>\n                </router-link>\n            </div>\n        </div>\n    </div>\n</template>\n\n<style lang=\"scss\" scoped>\n#search {\n    position: fixed;\n    z-index: 2000;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: var(--el-overlay-color-lighter);\n    backdrop-filter: blur(10px);\n    transition: all 0.2s;\n    transform: translateZ(0);\n    opacity: 0;\n    visibility: hidden;\n    &.searching {\n        opacity: 1;\n        visibility: visible;\n        .container {\n            transform: initial;\n            filter: initial;\n        }\n    }\n    .container {\n        display: flex;\n        flex-direction: column;\n        max-width: 800px;\n        height: 100%;\n        margin: 0 auto;\n        transition: all 0.2s;\n        transform: scale(1.1);\n        filter: blur(10px);\n        .search-box {\n            margin: 50px 20px 40px;\n            :deep(.el-input__inner) {\n                height: 52px;\n                line-height: 52px;\n            }\n            :deep(.el-input__icon) {\n                height: 100%;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n            .tips {\n                display: flex;\n                align-items: center;\n                justify-content: space-evenly;\n                margin-top: 20px;\n                line-height: 24px;\n                font-size: 14px;\n                color: #fff;\n                span {\n                    margin: 0 5px;\n                    padding: 3px 8px 5px;\n                    border-radius: 5px;\n                    font-size: 12px;\n                    font-weight: bold;\n                    color: var(--el-text-color-primary);\n                    background-color: var(--el-fill-color);\n                    box-shadow: inset 0 -2px var(--el-fill-color-lighter), inset 0 0 1px 1px var(--el-fill-color-darker);\n                }\n            }\n        }\n        .result {\n            position: relative;\n            margin: 0 20px;\n            max-height: calc(100% - 250px);\n            border-radius: 5px;\n            overflow: auto;\n            background-color: var(--el-bg-color);\n            box-shadow: 0 0 0 1px var(--el-border-color-darker);\n            &.mobile {\n                max-height: calc(100% - 200px);\n            }\n            .item {\n                display: flex;\n                align-items: center;\n                text-decoration: none;\n                cursor: pointer;\n                transition: all 0.3s;\n                &.actived {\n                    background-color: var(--el-bg-color-page);\n                    .icon {\n                        color: var(--el-color-primary);\n                        transform: scale(1.2);\n                    }\n                    .info {\n                        border-left-color: var(--el-border-color);\n                        .title {\n                            color: var(--el-text-color-primary);\n                        }\n                        .breadcrumb,\n                        .path {\n                            color: var(--el-text-color-regular);\n                        }\n                    }\n                }\n                .icon {\n                    flex: 0 0 66px;\n                    text-align: center;\n                    color: var(--el-color-info);\n                    font-size: 20px;\n                    transition: all 0.3s;\n                }\n                .info {\n                    flex: 1;\n                    height: 70px;\n                    display: flex;\n                    flex-direction: column;\n                    justify-content: space-around;\n                    border-left: 1px solid var(--el-border-color-lighter);\n                    padding: 5px 10px 7px;\n                    transition: all 0.3s;\n                    @include text-overflow(1, true);\n                    .title {\n                        font-size: 18px;\n                        font-weight: bold;\n                        color: var(--el-text-color-regular);\n                        @include text-overflow(1, true);\n                    }\n                    .breadcrumb,\n                    .path {\n                        font-size: 12px;\n                        color: var(--el-text-color-secondary);\n                        transition: all 0.3s;\n                        @include text-overflow(1, true);\n                    }\n                    .breadcrumb {\n                        span {\n                            margin-right: 5px;\n                            &:last-child i {\n                                display: none;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n</style>\n"],"names":["proxy","getCurrentInstance","settingsStore","useSettingsStore","routeStore","useRouteStore","menuStore","useMenuStore","isShow","ref","searchInput","sourceList","actived","resultList","computed","result","value","filter","item","flag","title","indexOf","path","breadcrumb","some","b","getSourceList","arr","map","meta","sidebar","children","every","i","hasChildren","baseBreadcrumb","deepClone","push","child","c","baseIcon","icon","basePath","join","isExternalLink","i18n","keyUp","length","handleScroll","keyDown","keyEnter","$refs","click","scrollTo","scrollTop","activedOffsetTop","offsetTop","activedClientHeight","clientHeight","searchScrollTop","searchClientHeight","top","watch","val","document","querySelector","classList","add","search","$hotkeys","setTimeout","input","focus","remove","unbind","onMounted","$eventBus","on","e","topbar","enableNavSearch","preventDefault","app","routeBaseOn","routes","menus"],"mappings":"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"}